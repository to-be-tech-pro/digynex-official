import{Q as te,a as P,b as ae,c as C}from"./QTabPanels-CJnekpGK.js";import{r,o as se,O as S,m as u,n as z,p as a,q as n,f as t,X as d,Y as D,P as G,y as p,v as o,z as i,C as A,N as v,R as ne,Q as f,a9 as le,F as oe,B as re,U as de,a8 as N}from"./index-BCoBQOFT.js";import{Q as ie}from"./QSelect-DZMeRPTx.js";import{Q as U}from"./QChip-B9sWOFsV.js";import{Q as O}from"./QBanner-9GPSZcrN.js";import{Q as ce}from"./QToolbarTitle-DloqS1VZ.js";import{Q as $}from"./QTooltip-C3k5xbmb.js";import{Q as ue}from"./QToolbar-D2GMqklU.js";import{Q as me,a as T}from"./QItem-Wb4A_Ad7.js";import{Q as E}from"./QItemLabel-djxoAbwS.js";import{Q as pe}from"./QList-TwHTGU55.js";import{Q as fe,a as V}from"./QTable-Dv_xctJK.js";import{Q as ge}from"./QBadge-CD0MS9Rg.js";import{Q as ve}from"./QPage-DNQfSVvF.js";import{u as be}from"./use-quasar-DuPF83ky.js";import{m as ye}from"./vue3-apexcharts-jBJOZXzt.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QResizeObserver-CLJoVRmi.js";import"./touch-BjYP5sR0.js";import"./position-engine-BGz6yeZ8.js";import"./use-render-cache-DLxPkVnQ.js";import"./QMenu-CRQWq3Fk.js";import"./format-CoaQEihs.js";import"./QLinearProgress-DcUDM4wH.js";const he={class:"row q-col-gutter-md items-center"},_e={class:"col-12 col-md-4"},we={class:"col-12 col-md-3"},qe={key:0,class:"col-12 col-md-5 text-right"},Se={key:0,class:"row q-col-gutter-lg"},ke={class:"col-12 col-md-4"},Qe={key:0,class:"q-mt-md fade-enter-active"},Pe={class:"col-12 col-md-8"},Ce={key:0,class:"q-pa-md text-center"},Ae={key:1,class:"q-pa-lg text-center text-grey"},Te={class:"row q-gutter-sm"},Ve={key:1,class:"text-center q-pa-xl text-grey-5"},Me={class:"row q-col-gutter-lg"},Le={class:"col-12 col-md-4"},Be={class:"text-caption text-green q-mt-xs"},Ie={class:"col-12 col-md-4"},ze={class:"col-12 col-md-4"},De={class:"col-12 col-md-8"},Ge={class:"col-12 col-md-4"},Ne={class:"text-weight-bold"},Ue={class:"text-caption text-grey"},Oe={__name:"AttendancePage",setup($e){const M=ye,b=be(),h=r("mark"),_=r(!1),k=r([]),c=r(null),w=r(new Date().toISOString().split("T")[0]),m=r([]),y=r(""),q=r(""),Q=r(null),R={chart:{type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1,columnWidth:"55%"}},dataLabels:{enabled:!1},xaxis:{categories:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},colors:["#3b82f6"]},W=[{name:"Present Students",data:[45,52,38,24,33,65,60]}],F={labels:["Present","Absent","Late"],colors:["#22c55e","#ef4444","#f97316"],legend:{position:"bottom"}},K=[75,15,10],j=[{name:"name",label:"Student Name",field:"name",align:"left"},{name:"consecutive",label:"Consecutive Absence",field:"consecutive",align:"center"},{name:"lastPresent",label:"Last Seen",field:"lastPresent",align:"left"},{name:"parentPhone",label:"Parent Contact",field:"parentPhone",align:"left"},{name:"actions",label:"Actions",field:"actions",align:"right"}],X=r([{id:101,name:"Kavindu Perera",class:"Grade 10 - Maths",consecutive:3,lastPresent:"2026-01-20",parentPhone:"0771234567"},{id:102,name:"Shehan Silva",class:"Grade 11 - Science",consecutive:4,lastPresent:"2026-01-15",parentPhone:"0719876543"},{id:103,name:"Nethmi Fernando",class:"Grade 9 - English",consecutive:3,lastPresent:"2026-01-22",parentPhone:"0705556667"}]);se(async()=>{await Y()});const Y=async()=>{const{data:l}=await S.from("classes").select("*").eq("status","Active");k.value=l||[],(!l||l.length===0)&&(k.value=[{id:1,name:"Grade 10 - Maths",grade:"Grade 10"},{id:2,name:"Grade 11 - Science",grade:"Grade 11"}])},L=async()=>{if(!c.value)return;_.value=!0;const{data:l,error:e}=await S.from("students").select("*").eq("grade",c.value.grade).eq("status","Active"),{data:s}=await S.from("attendance").select("*").eq("class_id",c.value.id).eq("date",w.value);if(e||!l||l.length===0){m.value=[{id:1,name:"Kasun Perera",phone:"077111222",attendance:"Absent"},{id:2,name:"Amal Silva",phone:"077333444",attendance:"Absent"},{id:3,name:"Ruwan Dias",phone:"077555666",attendance:"Absent"}],_.value=!1;return}m.value=l.map(g=>{const I=s?s.find(ee=>ee.student_id===g.id):null;return{...g,attendance:I?I.status:"Absent"}}),_.value=!1},x=async(l,e)=>{l.attendance=e;const{error:s}=await S.from("attendance").upsert({class_id:c.value.id,student_id:l.id,date:w.value,status:e},{onConflict:"class_id, student_id, date"});s&&(console.warn("DB Update failed (Expected if table missing):",s.message),b.notify({type:"warning",message:"Saved locally (DB sync failed)"}))},H=async()=>{confirm("Mark all displayed students as Present?")&&(m.value.forEach(l=>x(l,"Present")),b.notify({type:"positive",message:"All marked Present!"}))},B=async()=>{if(!y.value)return;const l=parseInt(y.value),e=m.value.find(s=>s.id===l);e?(await x(e,"Present"),q.value=e.name,setTimeout(()=>q.value="",3e3)):b.notify({type:"warning",message:"Student not found in this class!"}),y.value="",Q.value&&Q.value.focus()},J=()=>{b.notify({type:"info",message:"Sending SMS to parents of absent students...",icon:"sms",timeout:2e3})},Z=l=>{b.notify({type:"negative",message:`Warning SMS sent to ${l.name}'s parent.`,icon:"send"})};return(l,e)=>(u(),z(ve,{class:"q-pa-lg"},{default:a(()=>[e[24]||(e[24]=n("div",{class:"row items-center justify-between q-mb-lg"},[n("div",null,[n("h1",{class:"text-h5 text-weight-bold q-my-none text-dark"},"Attendance Management"),n("p",{class:"text-grey-6 q-mt-xs q-mb-none"},"Mark and track student attendance.")])],-1)),t(d,{class:"no-shadow border-gray q-mb-lg"},{default:a(()=>[t(te,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:a(()=>[t(P,{name:"mark",label:"Mark Attendance",icon:"check_circle"}),t(P,{name:"reports",label:"Attendance Reports",icon:"bar_chart"}),t(P,{name:"absent",label:"Absence Tracking",icon:"warning"})]),_:1},8,["modelValue"])]),_:1}),t(ae,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s),animated:"",class:"bg-transparent"},{default:a(()=>[t(C,{name:"mark",class:"q-pa-none"},{default:a(()=>[t(d,{class:"no-shadow border-gray q-mb-lg bg-white"},{default:a(()=>[t(D,{class:"q-pb-none"},{default:a(()=>[...e[5]||(e[5]=[n("div",{class:"text-subtitle1 text-weight-bold"},"Select Class Session",-1)])]),_:1}),t(D,null,{default:a(()=>[n("div",he,[n("div",_e,[t(ie,{outlined:"",modelValue:c.value,"onUpdate:modelValue":[e[1]||(e[1]=s=>c.value=s),L],options:k.value,"option-label":"name",label:"Select Class",dense:""},null,8,["modelValue","options"])]),n("div",we,[t(G,{outlined:"",modelValue:w.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>w.value=s),L],type:"date",label:"Date",dense:""},null,8,["modelValue"])]),c.value?(u(),p("div",qe,[t(U,{color:"blue-1","text-color":"primary",icon:"school"},{default:a(()=>[o(i(c.value.grade),1)]),_:1}),t(U,{color:"green-1","text-color":"green",icon:"group"},{default:a(()=>[o(i(m.value.length)+" Students ",1)]),_:1})])):A("",!0)])]),_:1})]),_:1}),c.value?(u(),p("div",Se,[n("div",ke,[t(d,{class:"no-shadow border-gray bg-grey-1 text-center q-pa-lg h-full"},{default:a(()=>[t(v,{name:"qr_code_scanner",size:"48px",color:"primary",class:"q-mb-md"}),e[8]||(e[8]=n("div",{class:"text-h6 text-weight-bold"},"Quick Scan",-1)),e[9]||(e[9]=n("p",{class:"text-caption text-grey-7"},"Scan student ID card to mark present.",-1)),t(G,{ref_key:"scanInput",ref:Q,outlined:"",modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=s=>y.value=s),placeholder:"Click here & Scan...",dense:"","bg-color":"white",onKeyup:ne(B,["enter"]),autofocus:""},{append:a(()=>[t(v,{name:"send",class:"cursor-pointer",onClick:B})]),_:1},8,["modelValue"]),q.value?(u(),p("div",Qe,[t(O,{rounded:"",class:"bg-green-1 text-green-9"},{avatar:a(()=>[t(v,{name:"check_circle",color:"green"})]),default:a(()=>[e[6]||(e[6]=o(" Marked ",-1)),n("strong",null,i(q.value),1),e[7]||(e[7]=o(" as Present! ",-1))]),_:1})])):A("",!0)]),_:1})]),n("div",Pe,[t(d,{class:"no-shadow border-gray"},{default:a(()=>[t(ue,{class:"bg-white q-pl-md q-pr-md border-bottom-light"},{default:a(()=>[t(ce,{class:"text-subtitle1"},{default:a(()=>[...e[10]||(e[10]=[o("Student List",-1)])]),_:1}),t(f,{flat:"",round:"",dense:"",icon:"sms",color:"blue",onClick:J,class:"q-mr-sm"},{default:a(()=>[t($,null,{default:a(()=>[...e[11]||(e[11]=[o("Send SMS to Absentees (Simulation)",-1)])]),_:1})]),_:1}),t(f,{flat:"",round:"",dense:"",icon:"done_all",color:"primary",onClick:H},{default:a(()=>[t($,null,{default:a(()=>[...e[12]||(e[12]=[o("Mark All Present",-1)])]),_:1})]),_:1})]),_:1}),t(pe,{separator:""},{default:a(()=>[_.value?(u(),p("div",Ce,[t(le,{color:"primary",size:"2em"})])):m.value.length===0?(u(),p("div",Ae," No students found for this class grade. ")):A("",!0),(u(!0),p(oe,null,re(m.value,s=>(u(),z(me,{key:s.id,class:"q-py-md"},{default:a(()=>[t(T,{avatar:""},{default:a(()=>[t(de,{color:"grey-2","text-color":"primary"},{default:a(()=>[o(i(s.name.charAt(0)),1)]),_:2},1024)]),_:2},1024),t(T,null,{default:a(()=>[t(E,{class:"text-weight-bold"},{default:a(()=>[o(i(s.name),1)]),_:2},1024),t(E,{caption:""},{default:a(()=>[o("ID: "+i(s.id)+" | "+i(s.phone),1)]),_:2},1024)]),_:2},1024),t(T,{side:""},{default:a(()=>[n("div",Te,[t(f,{outline:s.attendance!=="Present",color:s.attendance==="Present"?"green":"grey-5",label:"Present",size:"sm",onClick:g=>x(s,"Present")},null,8,["outline","color","onClick"]),t(f,{outline:s.attendance!=="Absent",color:s.attendance==="Absent"?"red":"grey-5",label:"Absent",size:"sm",onClick:g=>x(s,"Absent")},null,8,["outline","color","onClick"]),t(f,{outline:s.attendance!=="Late",color:s.attendance==="Late"?"orange":"grey-5",label:"Late",size:"sm",onClick:g=>x(s,"Late")},null,8,["outline","color","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])):(u(),p("div",Ve,[t(v,{name:"playlist_add_check",size:"64px"}),e[13]||(e[13]=n("div",{class:"text-h6 q-mt-md"},"Please select a class to mark attendance",-1))]))]),_:1}),t(C,{name:"reports",class:"q-pa-none"},{default:a(()=>[n("div",Me,[n("div",Le,[t(d,{class:"no-shadow border-gray bg-white q-pa-md text-center"},{default:a(()=>[e[15]||(e[15]=n("div",{class:"text-subtitle2 text-grey"},"Average Attendance",-1)),e[16]||(e[16]=n("div",{class:"text-h3 text-weight-bold text-primary q-mt-sm"},"85%",-1)),n("div",Be,[t(v,{name:"trending_up"}),e[14]||(e[14]=o(" +2.4% from last month ",-1))])]),_:1})]),n("div",Ie,[t(d,{class:"no-shadow border-gray bg-white q-pa-md text-center"},{default:a(()=>[...e[17]||(e[17]=[n("div",{class:"text-subtitle2 text-grey"},"Total Sessions",-1),n("div",{class:"text-h3 text-weight-bold text-dark q-mt-sm"},"24",-1),n("div",{class:"text-caption text-grey q-mt-xs"},"This Month",-1)])]),_:1})]),n("div",ze,[t(d,{class:"no-shadow border-gray bg-white q-pa-md text-center"},{default:a(()=>[...e[18]||(e[18]=[n("div",{class:"text-subtitle2 text-grey"},"Best Attendance Class",-1),n("div",{class:"text-h4 text-weight-bold text-secondary q-mt-sm"},"Grade 10 - Maths",-1),n("div",{class:"text-caption text-grey q-mt-xs"},"98% Turnout",-1)])]),_:1})]),n("div",De,[t(d,{class:"no-shadow border-gray q-pa-md"},{default:a(()=>[e[19]||(e[19]=n("div",{class:"text-h6 q-mb-md"},"Attendance Trends (Last 7 Days)",-1)),t(N(M),{type:"bar",height:"300",options:R,series:W})]),_:1})]),n("div",Ge,[t(d,{class:"no-shadow border-gray q-pa-md"},{default:a(()=>[e[20]||(e[20]=n("div",{class:"text-h6 q-mb-md"},"Overall Status",-1)),t(N(M),{type:"donut",height:"300",options:F,series:K})]),_:1})])])]),_:1}),t(C,{name:"absent",class:"q-pa-none"},{default:a(()=>[t(O,{rounded:"",class:"bg-red-1 text-red-9 q-mb-lg border-red"},{avatar:a(()=>[t(v,{name:"warning",color:"red"})]),default:a(()=>[e[21]||(e[21]=o(" Showing students who have missed ",-1)),e[22]||(e[22]=n("strong",null,"3 or more consecutive classes",-1)),e[23]||(e[23]=o(". Urgent follow-up recommended. ",-1))]),_:1}),t(d,{class:"no-shadow border-gray"},{default:a(()=>[t(fe,{rows:X.value,columns:j,"row-key":"id",flat:""},{"body-cell-name":a(s=>[t(V,{props:s},{default:a(()=>[n("div",Ne,i(s.row.name),1),n("div",Ue,i(s.row.class),1)]),_:2},1032,["props"])]),"body-cell-consecutive":a(s=>[t(V,{props:s},{default:a(()=>[t(ge,{color:"red","text-color":"white",class:"text-subtitle2 q-pa-xs"},{default:a(()=>[o(i(s.row.consecutive)+" Classes ",1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-actions":a(s=>[t(V,{props:s,align:"right"},{default:a(()=>[t(f,{size:"sm",color:"primary",icon:"phone",label:"Call Parent",class:"q-mr-sm",href:`tel:${s.row.parentPhone}`},null,8,["href"]),t(f,{size:"sm",outline:"",color:"grey-8",icon:"sms",label:"Send Warning",onClick:g=>Z(s.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},pt=xe(Oe,[["__scopeId","data-v-e2e3b797"]]);export{pt as default};
