import{o as S,O as c,m as v,n as V,p as o,q as e,y as b,f as t,a9 as k,X as y,U as C,z as m,S as I,N as h,Y as q,P as _,a7 as N,Q as P,r as i}from"./index-BCoBQOFT.js";import{Q as B}from"./QBadge-CD0MS9Rg.js";import{Q as E}from"./QPage-DNQfSVvF.js";import{u as D}from"./use-quasar-DuPF83ky.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={key:0,class:"flex flex-center q-pa-xl"},L={key:1,class:"row q-col-gutter-lg"},$={class:"col-12 col-md-4"},M={class:"text-h6 text-weight-bold"},F={class:"text-caption text-grey-6 q-mb-md"},O={class:"text-left q-gutter-y-sm"},X={class:"row items-center"},Y={class:"text-grey-8"},j={class:"row items-center"},G={class:"text-grey-8"},H={class:"col-12 col-md-8"},J={class:"row q-col-gutter-md"},K={class:"col-12 col-sm-6"},R={class:"col-12 col-sm-6"},T={class:"row q-col-gutter-md"},W={class:"col-12"},Z={__name:"ProfilePage",setup(ee){const n=D(),w=i(!0),p=i(!1),f=i(!1),u=i(""),g=i(""),x=i(""),l=i({firstName:"",lastName:""}),d=i("");S(async()=>{try{const{data:{user:a}}=await c.auth.getUser();a&&(u.value=a.id,g.value=a.email,x.value=new Date(a.last_sign_in_at).toLocaleDateString(),a.user_metadata&&(l.value.firstName=a.user_metadata.first_name||"",l.value.lastName=a.user_metadata.last_name||""))}catch(a){console.error("Error fetching user:",a)}finally{w.value=!1}});const Q=async()=>{p.value=!0;try{const{error:a}=await c.auth.updateUser({data:{first_name:l.value.firstName,last_name:l.value.lastName}});if(a)throw a;const s=`${l.value.firstName} ${l.value.lastName}`.trim();if(u.value){const{error:r}=await c.from("profiles").update({name:s}).eq("id",u.value);r&&console.error("Error updating public profile:",r)}n.notify({type:"positive",message:"Profile updated successfully!"})}catch(a){console.error(a),n.notify({type:"negative",message:a.message||"Error updating profile"})}finally{p.value=!1}},U=async()=>{if(!d.value){n.notify({type:"warning",message:"Please enter a new password"});return}f.value=!0;try{const{error:a}=await c.auth.updateUser({password:d.value});if(a)throw a;n.notify({type:"positive",message:"Password updated successfully!"}),d.value=""}catch(a){n.notify({type:"negative",message:a.message})}finally{f.value=!1}};return(a,s)=>(v(),V(E,{class:"q-pa-lg"},{default:o(()=>[s[8]||(s[8]=e("div",{class:"row q-mb-lg"},[e("div",{class:"col"},[e("h1",{class:"text-h5 text-weight-bold q-my-none text-dark"},"Profile Settings"),e("p",{class:"text-grey-6 q-mt-xs q-mb-none"},"Manage your personal information and security.")])],-1)),w.value?(v(),b("div",A,[t(k,{color:"primary",size:"3em"})])):(v(),b("div",L,[e("div",$,[t(y,{class:"no-shadow border-gray text-center q-pa-lg h-full"},{default:o(()=>[t(C,{size:"100px",class:"q-mb-md relative-position"},{default:o(()=>[...s[3]||(s[3]=[e("img",{src:"https://cdn.quasar.dev/img/boy-avatar.png"},null,-1)])]),_:1}),e("div",M,m(g.value),1),e("div",F,"User ID: "+m(u.value),1),t(B,{color:"primary",label:"Authenticated User",class:"q-mb-lg"}),t(I,{class:"q-my-md"}),e("div",O,[e("div",X,[t(h,{name:"email",color:"grey-6",class:"q-mr-sm"}),e("span",Y,m(g.value),1)]),e("div",j,[t(h,{name:"info",color:"grey-6",class:"q-mr-sm"}),e("span",G,"Last Sign In: "+m(x.value),1)])])]),_:1})]),e("div",H,[t(y,{class:"no-shadow border-gray q-mb-md"},{default:o(()=>[t(q,null,{default:o(()=>[s[4]||(s[4]=e("div",{class:"text-subtitle1 text-weight-bold q-mb-md"},"Profile Information",-1)),s[5]||(s[5]=e("p",{class:"text-caption text-grey-7"},"Update your profile details below.",-1)),e("div",J,[e("div",K,[t(_,{outlined:"",modelValue:l.value.firstName,"onUpdate:modelValue":s[0]||(s[0]=r=>l.value.firstName=r),label:"First Name",dense:"",hint:"Update via metadata"},null,8,["modelValue"])]),e("div",R,[t(_,{outlined:"",modelValue:l.value.lastName,"onUpdate:modelValue":s[1]||(s[1]=r=>l.value.lastName=r),label:"Last Name",dense:""},null,8,["modelValue"])])])]),_:1}),t(N,{align:"right",class:"q-pa-md"},{default:o(()=>[t(P,{unelevated:"",label:"Save Changes",color:"primary","no-caps":"",onClick:Q,loading:p.value},null,8,["loading"])]),_:1})]),_:1}),t(y,{class:"no-shadow border-gray"},{default:o(()=>[t(q,null,{default:o(()=>[s[6]||(s[6]=e("div",{class:"text-subtitle1 text-weight-bold q-mb-md text-red-7"},"Security",-1)),s[7]||(s[7]=e("p",{class:"text-grey-7 text-caption"},"Change your password.",-1)),e("div",T,[e("div",W,[t(_,{outlined:"",modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=r=>d.value=r),label:"New Password",type:"password",dense:""},null,8,["modelValue"])])])]),_:1}),t(N,{align:"right",class:"q-pa-md"},{default:o(()=>[t(P,{outline:"",label:"Update Password",color:"red-7","no-caps":"",onClick:U,loading:f.value},null,8,["loading"])]),_:1})]),_:1})])]))]),_:1}))}},re=z(Z,[["__scopeId","data-v-d3e00d40"]]);export{re as default};
