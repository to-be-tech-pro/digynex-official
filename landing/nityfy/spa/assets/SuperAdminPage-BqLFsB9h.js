import{o as O,m as k,n as F,p as t,q as s,f as a,X as c,N as V,z as w,v as J,Q as _,y as W,C as X,W as Y,Y as N,D as G,O as u,r as d}from"./index-BCoBQOFT.js";import{Q as H,a as x,b as K,c as h}from"./QTabPanels-CJnekpGK.js";import{Q as q}from"./QBadge-CD0MS9Rg.js";import{Q as P,a as p}from"./QTable-Dv_xctJK.js";import{Q as Z}from"./QSpace-BMoCBDdG.js";import{Q as ee}from"./QPage-DNQfSVvF.js";import{C as ae}from"./ClosePopup-DoFqAVUY.js";import{u as le}from"./use-quasar-DuPF83ky.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QResizeObserver-CLJoVRmi.js";import"./QSelect-DZMeRPTx.js";import"./QChip-B9sWOFsV.js";import"./QItem-Wb4A_Ad7.js";import"./QItemLabel-djxoAbwS.js";import"./QMenu-CRQWq3Fk.js";import"./position-engine-BGz6yeZ8.js";import"./format-CoaQEihs.js";import"./touch-BjYP5sR0.js";import"./use-render-cache-DLxPkVnQ.js";import"./QList-TwHTGU55.js";import"./QLinearProgress-DcUDM4wH.js";const oe={class:"row q-col-gutter-md q-mb-xl"},se={class:"col-12 col-md-4"},ne={class:"row items-center no-wrap"},re={class:"text-h4 text-weight-bold text-emerald-9 q-mt-xs"},ie={class:"col-12 col-md-4"},de={class:"row items-center no-wrap"},ce={class:"text-h4 text-weight-bold text-blue-9 q-mt-xs"},me={key:0,class:"q-pa-lg text-center text-grey"},ue=["src"],pe={__name:"SuperAdminPage",setup(fe){const f=le(),g=d("organizations"),m=d(!1),b=d(null),v=d([]),n=d([]),y=d(!1),Q=d(""),C=d([]),j=[{name:"id",label:"User ID",field:"id",align:"left",sortable:!0,style:"max-width: 150px; overflow: hidden; text-overflow: ellipsis;"},{name:"full_name",label:"Name",field:l=>`${l.first_name||""} ${l.last_name||""}`,align:"left",sortable:!0},{name:"email",label:"Email",field:"email",align:"left",sortable:!0},{name:"plan",label:"Plan Type",field:"plan_type",align:"left"},{name:"student_count",label:"Students",field:"student_count",align:"center",sortable:!0},{name:"created_at",label:"Joined",field:"created_at",align:"right",format:l=>new Date(l).toLocaleDateString()}],E=[{name:"user_id",label:"User ID",field:"user_id",align:"left"},{name:"amount",label:"Amount",field:"amount",align:"left"},{name:"currency",label:"Currency",field:"currency",align:"left"},{name:"date",label:"Date",field:"created_at",align:"left",format:l=>new Date(l).toLocaleString()},{name:"receipt",label:"Proof",field:"receipt_url",align:"center"},{name:"status",label:"Status",field:"status",align:"center"},{name:"actions",label:"Actions",field:"actions",align:"right"}],R=[{name:"email",label:"Email",field:"email",align:"left",sortable:!0},{name:"full_name",label:"Name",field:l=>`${l.first_name||""} ${l.last_name||""}`,align:"left",sortable:!0},{name:"role",label:"Role",field:"role",align:"left",sortable:!0},{name:"plan",label:"Plan",field:"plan_type",align:"center",sortable:!0},{name:"joined",label:"Joined",field:"created_at",align:"right",format:l=>new Date(l).toLocaleDateString()}],U=["amilawijayanthaperera@gmail.com","amilawijayanthaperera858@gmail.com","admin@digynex.com"],T=["74736fbf-0700-4a0d-b797-84d0b0b3b554"],$=l=>U.includes(l.email?.toLowerCase())||T.includes(l.id),S=async()=>{m.value=!0;try{const{data:l,error:o}=await u.from("profiles").select("*");if(o)throw o;const{data:e}=await u.from("students").select("user_id"),r={};e&&e.forEach(i=>{i.user_id&&(r[i.user_id]=(r[i.user_id]||0)+1)});const D=l.map(i=>({...i,email:i.email||"N/A",student_count:r[i.id]||0,role:$(i)?"Super Admin":"User"}));v.value=D,C.value=D;const{data:M,error:z}=await u.from("payment_proofs").select("*").eq("status","pending");if(z)throw z;n.value=M}catch(l){console.error(l),f.notify({type:"negative",message:"Failed to load data"})}finally{m.value=!1}},A=l=>{switch(l){case"pro":return"emerald";case"growth":return"blue";default:return"grey"}},I=l=>{Q.value=l,y.value=!0},B=async l=>{b.value=l.id;try{const{error:o}=await u.from("profiles").update({plan_type:"pro"}).eq("id",l.user_id);if(o)throw o;const{error:e}=await u.from("payment_proofs").update({status:"approved"}).eq("id",l.id);if(e)throw e;f.notify({type:"positive",message:"Plan Upgraded to Pro!"}),n.value=n.value.filter(r=>r.id!==l.id),S()}catch(o){f.notify({type:"negative",message:"Action failed: "+o.message})}finally{b.value=null}},L=async l=>{f.dialog({title:"Reject Payment",message:"Are you sure?",cancel:!0,persistent:!0}).onOk(async()=>{const{error:o}=await u.from("payment_proofs").update({status:"rejected"}).eq("id",l.id);o||(n.value=n.value.filter(e=>e.id!==l.id),f.notify({type:"info",message:"Payment rejected."}))})};return O(()=>{S()}),(l,o)=>(k(),F(ee,{class:"q-pa-lg"},{default:t(()=>[o[6]||(o[6]=s("div",{class:"row items-center justify-between q-mb-lg"},[s("div",null,[s("h1",{class:"text-h5 text-weight-bold q-my-none text-primary"},"Super Admin Panel"),s("p",{class:"text-grey-5 q-mt-xs q-mb-none"}," Manage system-wide settings, user organizations, and approvals. ")])],-1)),s("div",oe,[s("div",se,[a(c,{class:"no-shadow border-emerald q-pa-md bg-emerald-1"},{default:t(()=>[s("div",ne,[a(V,{name:"apartment",size:"md",class:"text-emerald-9 q-mr-md"}),s("div",null,[o[3]||(o[3]=s("div",{class:"text-caption text-emerald-9 text-uppercase text-weight-bold"}," Total Organizations ",-1)),s("div",re,w(v.value.length),1)])])]),_:1})]),s("div",ie,[a(c,{class:"no-shadow border-blue q-pa-md bg-blue-1"},{default:t(()=>[s("div",de,[a(V,{name:"pending_actions",size:"md",class:"text-blue-9 q-mr-md"}),s("div",null,[o[4]||(o[4]=s("div",{class:"text-caption text-blue-9 text-uppercase text-weight-bold"}," Pending Approvals ",-1)),s("div",ce,w(n.value.length),1)])])]),_:1})])]),a(c,{class:"no-shadow border-gray q-mb-lg"},{default:t(()=>[a(H,{modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=e=>g.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:t(()=>[a(x,{name:"organizations",label:"Registered Organizations",icon:"business"}),a(x,{name:"approvals",label:"Payment Approvals",icon:"verified"}),a(x,{name:"users",label:"All Users",icon:"group"})]),_:1},8,["modelValue"])]),_:1}),a(K,{modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=e=>g.value=e),animated:"",class:"bg-transparent"},{default:t(()=>[a(h,{name:"organizations",class:"q-pa-none"},{default:t(()=>[a(c,{class:"no-shadow border-gray"},{default:t(()=>[a(P,{rows:v.value,columns:j,"row-key":"id",flat:"",loading:m.value},{"body-cell-plan":t(e=>[a(p,{props:e},{default:t(()=>[a(q,{color:A(e.row.plan_type),label:e.row.plan_type||"Free",class:"q-px-sm text-capitalize"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-student_count":t(e=>[a(p,{props:e},{default:t(()=>[J(w(e.row.student_count||0),1)]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}),a(h,{name:"approvals",class:"q-pa-none"},{default:t(()=>[a(c,{class:"no-shadow border-gray"},{default:t(()=>[a(P,{rows:n.value,columns:E,"row-key":"id",flat:"",loading:m.value},{"body-cell-receipt":t(e=>[a(p,{props:e},{default:t(()=>[a(_,{flat:"",dense:"",color:"primary",icon:"visibility",label:"View Receipt",onClick:r=>I(e.row.receipt_url),"no-caps":"",size:"sm"},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[a(p,{props:e,align:"right"},{default:t(()=>[a(_,{unelevated:"",size:"sm",color:"emerald",label:"Approve",class:"q-mr-sm",onClick:r=>B(e.row),loading:b.value===e.row.id},null,8,["onClick","loading"]),a(_,{outline:"",size:"sm",color:"red",label:"Reject",onClick:r=>L(e.row),loading:b.value===e.row.id},null,8,["onClick","loading"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"]),n.value.length===0&&!m.value?(k(),W("div",me," No pending approvals found. ")):X("",!0)]),_:1})]),_:1}),a(h,{name:"users",class:"q-pa-none"},{default:t(()=>[a(c,{class:"no-shadow border-gray"},{default:t(()=>[a(P,{rows:C.value,columns:R,"row-key":"id",flat:"",loading:m.value},{"body-cell-role":t(e=>[a(p,{props:e},{default:t(()=>[a(q,{color:e.row.role==="Super Admin"?"purple":"grey-7",label:e.row.role,class:"q-px-sm"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-plan":t(e=>[a(p,{props:e},{default:t(()=>[a(q,{color:A(e.row.plan_type),label:e.row.plan_type||"Free",class:"q-px-sm text-capitalize"},null,8,["color","label"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:y.value,"onUpdate:modelValue":o[2]||(o[2]=e=>y.value=e)},{default:t(()=>[a(c,{style:{"min-width":"300px","max-width":"80vw"}},{default:t(()=>[a(N,{class:"row items-center q-pb-none"},{default:t(()=>[o[5]||(o[5]=s("div",{class:"text-h6"},"Payment Receipt",-1)),a(Z),G(a(_,{icon:"close",flat:"",round:"",dense:""},null,512),[[ae]])]),_:1}),a(N,null,{default:t(()=>[s("img",{src:Q.value,style:{width:"100%","max-height":"500px","object-fit":"contain"}},null,8,ue)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Re=te(pe,[["__scopeId","data-v-49872cbe"]]);export{Re as default};
