import{o as T,m as E,n as j,p as n,q as s,f as t,Q as i,X as C,v as q,z as g,t as S,W as B,Y as L,D as A,P as m,a8 as W,S as F,a7 as M,O as p,r as u}from"./index-BCoBQOFT.js";import{Q as R}from"./QLinearProgress-DcUDM4wH.js";import{Q as H,a as x}from"./QTable-Dv_xctJK.js";import{Q as J}from"./QChip-B9sWOFsV.js";import{Q as Y}from"./QTooltip-C3k5xbmb.js";import{Q as K}from"./QSpace-BMoCBDdG.js";import{Q as N}from"./QSelect-DZMeRPTx.js";import{Q as X}from"./QSlider-CZBTv6a5.js";import{Q as Z}from"./QPage-DNQfSVvF.js";import{C as I}from"./ClosePopup-DoFqAVUY.js";import{u as G}from"./use-quasar-DuPF83ky.js";import{u as ee}from"./currency-FmnwYlLu.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QList-TwHTGU55.js";import"./position-engine-BGz6yeZ8.js";import"./QItem-Wb4A_Ad7.js";import"./QItemLabel-djxoAbwS.js";import"./QMenu-CRQWq3Fk.js";import"./format-CoaQEihs.js";import"./TouchPan-DDYz_H52.js";import"./touch-BjYP5sR0.js";import"./index-D5GkNzM3.js";const te={class:"row items-center justify-between q-mb-lg"},le={class:"col-auto"},se={class:"row items-center no-wrap q-gutter-x-sm"},oe={class:"text-h6"},ne={class:"row q-col-gutter-sm"},re={class:"col-8"},de={class:"col-4"},ie={class:"row q-col-gutter-sm"},ue={class:"col-12 col-sm-6"},ce={class:"col-12 col-sm-6"},me={class:"row q-col-gutter-sm"},pe={class:"col-12 col-sm-6"},fe={class:"col-12 col-sm-6"},ge={class:"row items-center justify-between q-mb-xs"},ve={class:"q-pt-sm"},ye={class:"row justify-between items-center q-mb-xs"},be={__name:"LeadsPage",setup(we){const d=G(),v=u(!1),y=u(!1),b=u(!1),c=u(!1),h=u([]),l=u({name:"",email:"",phone:"",source:"Website",status:"New",estimated_value:0,lead_score:50,notes:""}),V=ee(),P=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"score",label:"Potential",field:"lead_score",align:"center",sortable:!0},{name:"email",label:"Email",field:"email",align:"left"},{name:"source",label:"Source",field:"source",align:"left"},{name:"status",label:"Status",field:"status",align:"center",sortable:!0},{name:"value",label:"Value",field:"estimated_value",align:"right",format:o=>V.format(o)},{name:"actions",label:"Actions",field:"actions",align:"right"}],f=o=>o>=80?"emerald":o>=50?"blue":o>=25?"orange":"red",k=async()=>{if(!l.value.notes){d.notify({type:"warning",message:"Add some notes for AI to analyze"});return}const o="AIzaSyBmazATys8hcIJUgMHpZuSxEUQU038HLFg";b.value=!0;try{const e=await(await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Analyze this lead based on notes and provide a potential score out of 100. Return ONLY the number. 
Notes: ${l.value.notes}`}]}]})})).json(),r=parseInt(e.candidates[0].content.parts[0].text.trim());isNaN(r)||(l.value.lead_score=r,d.notify({type:"positive",message:`AI scored this lead at ${r}%`}))}catch{d.notify({type:"negative",message:"AI Analysis failed"})}b.value=!1},U=o=>{switch(o){case"New":return"blue";case"Qualified":return"orange";case"In Progress":return"indigo";case"Lost":return"red";case"Converted":return"green";default:return"grey"}},z=o=>{Q(o),setTimeout(()=>{k()},300)},w=async()=>{v.value=!0;const{data:o,error:a}=await p.from("leads").select("*").order("created_at",{ascending:!1});a?d.notify({type:"negative",message:"Failed to fetch leads"}):h.value=o,v.value=!1},D=()=>{l.value={name:"",email:"",phone:"",source:"Website",status:"New",estimated_value:0,lead_score:50,notes:""},c.value=!0},Q=o=>{l.value={...o},c.value=!0},O=async()=>{if(!l.value.name)return;y.value=!0;const{data:o}=await p.auth.getUser(),a=o.user.id,e={...l.value,user_id:a};let r;if(l.value.id){const{error:_}=await p.from("leads").update(e).eq("id",l.value.id);r=_}else{const{error:_}=await p.from("leads").insert(e);r=_}r?d.notify({type:"negative",message:"Error saving lead: "+r.message}):(d.notify({type:"positive",message:"Lead saved successfully"}),c.value=!1,w()),y.value=!1},$=o=>{d.dialog({title:"Confirm Delete",message:`Are you sure you want to delete lead: ${o.name}?`,cancel:!0,persistent:!0,dark:!0}).onOk(async()=>{const{error:a}=await p.from("leads").delete().eq("id",o.id);a?d.notify({type:"negative",message:"Error deleting lead"}):(d.notify({type:"positive",message:"Lead deleted"}),w())})};return T(async()=>{w()}),(o,a)=>(E(),j(Z,{class:"q-pa-lg"},{default:n(()=>[s("div",te,[a[9]||(a[9]=s("div",{class:"col"},[s("h1",{class:"text-h5 text-weight-bold q-my-none text-white"},"Leads & Inquiries"),s("p",{class:"text-grey-5 q-mt-xs q-mb-none"}," Track and manage potential business opportunities. ")],-1)),s("div",le,[t(i,{unelevated:"",rounded:"",class:"bg-blue-gradient text-white q-px-lg shadow-2",icon:"add",label:"Add New Lead","no-caps":"",onClick:D})])]),t(C,{class:"bg-dark-card border-glass no-shadow border-radius-lg overflow-hidden"},{default:n(()=>[t(H,{rows:h.value,columns:P,"row-key":"id",flat:"",dark:"",class:"bg-transparent",loading:v.value,pagination:{rowsPerPage:10}},{"body-cell-score":n(e=>[t(x,{props:e},{default:n(()=>[s("div",se,[t(R,{value:e.row.lead_score/100,color:f(e.row.lead_score),rounded:"",class:"col",style:{height:"6px"}},null,8,["value","color"]),s("span",{class:S(["text-caption text-weight-bold",`text-${f(e.row.lead_score)}`]),style:{"min-width":"30px"}},g(e.row.lead_score)+"% ",3)])]),_:2},1032,["props"])]),"body-cell-status":n(e=>[t(x,{props:e},{default:n(()=>[t(J,{dense:"",color:U(e.row.status),"text-color":"white",class:"text-weight-bold"},{default:n(()=>[q(g(e.row.status),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-actions":n(e=>[t(x,{props:e,class:"q-gutter-x-sm"},{default:n(()=>[t(i,{flat:"",round:"",dense:"",icon:"insights",color:"purple-4",onClick:r=>z(e.row)},{default:n(()=>[t(Y,null,{default:n(()=>[...a[10]||(a[10]=[q("AI Lead Analysis",-1)])]),_:1})]),_:1},8,["onClick"]),t(i,{flat:"",round:"",dense:"",icon:"edit",color:"blue-4",onClick:r=>Q(e.row)},null,8,["onClick"]),t(i,{flat:"",round:"",dense:"",icon:"delete",color:"red-5",onClick:r=>$(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}),t(B,{modelValue:c.value,"onUpdate:modelValue":a[8]||(a[8]=e=>c.value=e),persistent:""},{default:n(()=>[t(C,{style:{"min-width":"500px"},class:"bg-dark text-white border-glass"},{default:n(()=>[t(L,{class:"row items-center q-pb-none"},{default:n(()=>[s("div",oe,g(l.value.id?"Edit Opportunity":"New Revenue Opportunity"),1),t(K),A(t(i,{icon:"close",flat:"",round:"",dense:""},null,512),[[I]])]),_:1}),t(L,{class:"q-pt-md q-gutter-y-md"},{default:n(()=>[s("div",ne,[s("div",re,[t(m,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.name=e),label:"Opportunity Name",dark:"",outlined:"",dense:""},null,8,["modelValue"])]),s("div",de,[t(N,{modelValue:l.value.status,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.status=e),label:"Status",options:["New","Qualified","In Progress","Lost","Converted"],dark:"",outlined:"",dense:""},null,8,["modelValue"])])]),s("div",ie,[s("div",ue,[t(m,{modelValue:l.value.email,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.email=e),label:"Email Address",dark:"",outlined:"",dense:""},null,8,["modelValue"])]),s("div",ce,[t(m,{modelValue:l.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.phone=e),label:"Phone",dark:"",outlined:"",dense:""},null,8,["modelValue"])])]),s("div",me,[s("div",pe,[t(N,{modelValue:l.value.source,"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.source=e),label:"Lead Source",options:["Website","LinkedIn","Referral","Facebook","Cold Outreach"],dark:"",outlined:"",dense:""},null,8,["modelValue"])]),s("div",fe,[t(m,{modelValue:l.value.estimated_value,"onUpdate:modelValue":a[5]||(a[5]=e=>l.value.estimated_value=e),modelModifiers:{number:!0},label:"Est. Value ("+W(V).symbol+")",type:"number",dark:"",outlined:"",dense:""},null,8,["modelValue","label"])])]),t(F,{dark:"",class:"q-my-sm"}),s("div",ge,[a[11]||(a[11]=s("div",{class:"text-caption text-grey-5 uppercase tracking-wider"}," Strategic Discovery Notes ",-1)),t(i,{flat:"",dense:"",rounded:"",color:"purple-4",icon:"auto_awesome",label:"AI Analyze","no-caps":"",size:"sm",onClick:k,loading:b.value},null,8,["loading"])]),t(m,{modelValue:l.value.notes,"onUpdate:modelValue":a[6]||(a[6]=e=>l.value.notes=e),type:"textarea",placeholder:"Add lead pain points, requirements, and discovery call notes...",dark:"",outlined:"",dense:"",rows:"3"},null,8,["modelValue"]),s("div",ve,[s("div",ye,[a[12]||(a[12]=s("div",{class:"text-caption text-grey-5"},"Lead Potential Score",-1)),s("div",{class:S(["text-weight-bold",`text-${f(l.value.lead_score)}`])},g(l.value.lead_score)+"% ",3)]),t(X,{modelValue:l.value.lead_score,"onUpdate:modelValue":a[7]||(a[7]=e=>l.value.lead_score=e),min:0,max:100,step:1,color:f(l.value.lead_score),dark:""},null,8,["modelValue","color"])])]),_:1}),t(M,{align:"right",class:"q-pa-md"},{default:n(()=>[A(t(i,{flat:"",label:"Cancel",color:"grey-6","no-caps":""},null,512),[[I]]),t(i,{unelevated:"",label:"Save Opportunity",class:"bg-blue-gradient text-white q-px-lg rounded-borders","no-caps":"",loading:y.value,onClick:O},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Be=ae(be,[["__scopeId","data-v-6e18e792"]]);export{Be as default};
