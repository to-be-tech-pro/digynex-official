import{o as L,O as w,m as y,n as V,p as t,q as r,f as a,Q as v,X as P,D as d,v as p,S as W,z as m,U as X,W as h,Y as Q,P as k,y as Y,C as G,a7 as N,r as u}from"./index-BCoBQOFT.js";import{Q as H,a as U}from"./QTable-Dv_xctJK.js";import{Q as E}from"./QBadge-CD0MS9Rg.js";import{Q as S,a as A}from"./QItem-Wb4A_Ad7.js";import{Q as J}from"./QList-TwHTGU55.js";import{Q as K}from"./QMenu-CRQWq3Fk.js";import{Q as R}from"./QSelect-DZMeRPTx.js";import{Q as Z}from"./QPage-DNQfSVvF.js";import{C as c}from"./ClosePopup-DoFqAVUY.js";import{u as ee}from"./use-quasar-DuPF83ky.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QLinearProgress-DcUDM4wH.js";import"./position-engine-BGz6yeZ8.js";import"./QChip-B9sWOFsV.js";import"./QItemLabel-djxoAbwS.js";import"./format-CoaQEihs.js";const le={class:"row items-center justify-between q-mb-lg"},te={class:"q-gutter-x-sm"},se={class:"row items-center no-wrap"},oe={class:"text-weight-bold"},re={class:"text-caption text-grey-6"},ne={class:"text-h6"},ie={key:0},ue={class:"text-caption text-grey-6"},de={__name:"UsersPage",setup(me){const n=ee(),b=u(!1),C=u(!1),o=u({}),f=u(!1),x=u(null),g=u(""),i=u(!1),M=[{name:"name",required:!0,label:"User Name",align:"left",field:"name",sortable:!0},{name:"role",align:"left",label:"Role",field:"role",sortable:!0},{name:"email",align:"left",label:"Email",field:"email"},{name:"status",align:"left",label:"Status",field:"status",sortable:!0},{name:"actions",align:"right",label:"",field:"actions"}],_=u([]);L(()=>{q()});const q=async()=>{i.value=!0;const{data:s,error:l}=await w.from("profiles").select("*").order("created_at",{ascending:!1});l?n.notify({type:"negative",message:"Error fetching users: "+l.message}):_.value=s,i.value=!1},B=s=>{switch(s){case"Admin":return"purple-1";case"Manager":return"blue-1";case"Staff":return"grey-2";default:return"grey-1"}},I=s=>{switch(s){case"Admin":return"purple-9";case"Manager":return"blue-9";case"Staff":return"grey-9";default:return"grey-8"}},T=()=>{o.value={status:"Active",role:"Staff",password:""},f.value=!1,b.value=!0},$=s=>{o.value={...s},f.value=!0,b.value=!0},z=s=>{x.value=s,g.value="",C.value=!0},O=async()=>{if(!g.value)return;i.value=!0;const{error:s}=await w.functions.invoke("users-admin",{body:{action:"updatePassword",id:x.value.id,password:g.value}});i.value=!1,s?n.notify({type:"negative",message:s.message}):n.notify({type:"positive",message:`Password updated for ${x.value.name}`,icon:"lock_reset"})},j=async()=>{if(i.value=!0,f.value){const{error:s}=await w.functions.invoke("users-admin",{body:{action:"updateProfile",id:o.value.id,name:o.value.name,role:o.value.role,status:o.value.status}});s?n.notify({type:"negative",message:s.message}):(n.notify({type:"positive",message:"User updated successfully"}),q())}else{const{error:s}=await w.functions.invoke("users-admin",{body:{action:"create",email:o.value.email,password:o.value.password,name:o.value.name,role:o.value.role}});s?n.notify({type:"negative",message:s.message}):(n.notify({type:"positive",message:"New user created successfully"}),q())}i.value=!1},F=s=>{n.dialog({title:"Confirm Deletion",message:"Are you sure you want to remove this user? This account will no longer be able to log in.",cancel:!0,persistent:!0,ok:{label:"Delete",color:"negative",flat:!0}}).onOk(async()=>{i.value=!0;const{error:l}=await w.functions.invoke("users-admin",{body:{action:"delete",id:s}});i.value=!1,l?n.notify({type:"negative",message:l.message}):(_.value=_.value.filter(e=>e.id!==s),n.notify({type:"positive",message:"User removed successfully",icon:"delete"}))})};return(s,l)=>(y(),V(Z,{class:"q-pa-lg"},{default:t(()=>[r("div",le,[l[8]||(l[8]=r("div",null,[r("h1",{class:"text-h5 text-weight-bold q-my-none text-dark"},"System Users"),r("p",{class:"text-grey-6 q-mt-xs q-mb-none"},"Manage system administrators and staff access.")],-1)),r("div",te,[a(v,{unelevated:"",icon:"add",color:"primary",label:"New User","no-caps":"",onClick:T})])]),a(P,{class:"no-shadow border-gray"},{default:t(()=>[a(H,{rows:_.value,columns:M,"row-key":"id",flat:"",bordered:"",pagination:{rowsPerPage:10}},{"body-cell-name":t(e=>[a(U,{props:e},{default:t(()=>[r("div",se,[a(X,{size:"32px",class:"q-mr-sm",color:"orange-1","text-color":"orange-9"},{default:t(()=>[p(m(e.row.name.charAt(0)),1)]),_:2},1024),r("div",null,[r("div",oe,m(e.row.name),1),r("div",re,m(e.row.email),1)])])]),_:2},1032,["props"])]),"body-cell-role":t(e=>[a(U,{props:e},{default:t(()=>[a(E,{color:B(e.row.role),"text-color":I(e.row.role),class:"q-px-sm",rounded:""},{default:t(()=>[p(m(e.row.role),1)]),_:2},1032,["color","text-color"])]),_:2},1032,["props"])]),"body-cell-status":t(e=>[a(U,{props:e},{default:t(()=>[a(E,{color:e.row.status==="Active"?"green-1":"red-1","text-color":e.row.status==="Active"?"green-8":"red-8",class:"q-px-sm q-py-xs text-weight-bold"},{default:t(()=>[p(m(e.row.status),1)]),_:2},1032,["color","text-color"])]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[a(U,{props:e,"auto-width":""},{default:t(()=>[a(v,{flat:"",round:"",dense:"",icon:"more_vert",color:"grey-7"},{default:t(()=>[a(K,null,{default:t(()=>[a(J,{style:{"min-width":"100px"}},{default:t(()=>[d((y(),V(S,{clickable:"",onClick:D=>$(e.row)},{default:t(()=>[a(A,null,{default:t(()=>[...l[9]||(l[9]=[p("Edit",-1)])]),_:1})]),_:1},8,["onClick"])),[[c]]),d((y(),V(S,{clickable:"",onClick:D=>z(e.row)},{default:t(()=>[a(A,null,{default:t(()=>[...l[10]||(l[10]=[p("Reset Password",-1)])]),_:1})]),_:1},8,["onClick"])),[[c]]),a(W),d((y(),V(S,{clickable:"",class:"text-red",onClick:D=>F(e.row.id)},{default:t(()=>[a(A,null,{default:t(()=>[...l[11]||(l[11]=[p("Delete",-1)])]),_:1})]),_:1},8,["onClick"])),[[c]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1}),a(h,{modelValue:b.value,"onUpdate:modelValue":l[5]||(l[5]=e=>b.value=e),persistent:""},{default:t(()=>[a(P,{style:{"min-width":"400px"}},{default:t(()=>[a(Q,null,{default:t(()=>[r("div",ne,m(f.value?"Edit User Details":"Add New User"),1)]),_:1}),a(Q,{class:"q-pt-none q-gutter-y-md"},{default:t(()=>[a(k,{outlined:"",modelValue:o.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value.name=e),label:"Full Name",dense:""},null,8,["modelValue"]),a(k,{outlined:"",modelValue:o.value.email,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.email=e),label:"Email Address",dense:""},null,8,["modelValue"]),a(R,{outlined:"",modelValue:o.value.role,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.role=e),options:["Admin","Manager","Staff","Editor"],label:"Role",dense:""},null,8,["modelValue"]),f.value?G("",!0):(y(),Y("div",ie,[a(k,{outlined:"",modelValue:o.value.password,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.password=e),label:"Password",type:"password",dense:"",hint:"Set an initial password for the user"},null,8,["modelValue"])])),a(R,{outlined:"",modelValue:o.value.status,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.status=e),options:["Active","Inactive"],label:"Status",dense:""},null,8,["modelValue"])]),_:1}),a(N,{align:"right",class:"text-primary q-pa-md"},{default:t(()=>[d(a(v,{flat:"",label:"Cancel",color:"grey"},null,512),[[c]]),d(a(v,{unelevated:"",label:f.value?"Save Changes":"Create User",color:"primary",onClick:j},null,8,["label"]),[[c]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(h,{modelValue:C.value,"onUpdate:modelValue":l[7]||(l[7]=e=>C.value=e),persistent:""},{default:t(()=>[a(P,{style:{"min-width":"400px"}},{default:t(()=>[a(Q,null,{default:t(()=>[l[12]||(l[12]=r("div",{class:"text-h6"},"Reset Password",-1)),r("div",ue," Set a new password for "+m(x.value?.name),1)]),_:1}),a(Q,{class:"q-pt-none"},{default:t(()=>[a(k,{outlined:"",modelValue:g.value,"onUpdate:modelValue":l[6]||(l[6]=e=>g.value=e),label:"New Password",type:"password",dense:""},null,8,["modelValue"])]),_:1}),a(N,{align:"right",class:"text-primary q-pa-md"},{default:t(()=>[d(a(v,{flat:"",label:"Cancel",color:"grey"},null,512),[[c]]),d(a(v,{unelevated:"",label:"Update Password",color:"primary",onClick:O},null,512),[[c]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Pe=ae(de,[["__scopeId","data-v-d072c949"]]);export{Pe as default};
