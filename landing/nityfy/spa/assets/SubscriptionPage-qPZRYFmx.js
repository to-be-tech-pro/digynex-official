import{o as T,O as f,m as n,n as m,p as a,q as s,z as d,a8 as i,f as t,X as C,Y as w,S as Q,y as h,F as U,B,N as P,v as g,a7 as k,Q as u,W as K,D as z,r as q,c as I}from"./index-BCoBQOFT.js";import{Q as D,a as y}from"./QItem-Wb4A_Ad7.js";import{Q as R}from"./QList-TwHTGU55.js";import{Q as L}from"./QBadge-CD0MS9Rg.js";import{Q as W}from"./QFile-C9mUrIyq.js";import{Q as j}from"./QPage-DNQfSVvF.js";import{C as G}from"./ClosePopup-DoFqAVUY.js";import{u as H}from"./use-quasar-DuPF83ky.js";import{u as X}from"./currency-FmnwYlLu.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-B9sWOFsV.js";import"./format-CoaQEihs.js";import"./index-D5GkNzM3.js";const J={class:"row items-center justify-between q-mb-xl"},Z={class:"bg-white q-px-md q-py-sm rounded-borders shadow-1"},ee={class:"text-uppercase"},te={class:"row q-col-gutter-lg justify-center"},se={class:"col-12 col-md-4 col-lg-3"},ae={class:"col-12 col-md-4 col-lg-3"},oe={class:"absolute-top-right q-pa-sm"},le={class:"text-h4 text-weight-bolder q-mt-sm"},re={class:"col-12 col-md-4 col-lg-3"},ne={class:"absolute-top-right q-pa-sm"},ie={class:"text-h4 text-weight-bolder q-mt-sm font-numeric"},de={key:0,class:"q-mt-sm fade-in"},ue={class:"bg-blue-1 text-blue-9 q-pa-md rounded-borders q-mb-md"},ce={class:"text-caption q-mt-sm"},me={class:"text-weight-bold"},pe={key:1,class:"q-mt-sm fade-in text-center"},fe={class:"text-h5 text-weight-bold q-mb-md"},ge={__name:"SubscriptionPage",setup(ye){const c=H(),r=X(),S=I(()=>r.countryCode),p=q("free"),v=q(!1),x=q(null),_=q(!1),b=q(null),N=["Max 10 Students","Basic Dashboard","Manual Attendance"],M=["Max 100 Students","QR Attendance","Manual & Stripe Payments","Email Support"],V=["Unlimited Students","0% Commission","Advanced Analytics","Priority Support","Custom Branding"];T(async()=>{const{data:{user:o}}=await f.auth.getUser();if(o){b.value=o;const{data:e}=await f.from("profiles").select("plan_type, country_code").eq("id",o.id).single();e&&(p.value=e.plan_type||"free",e.country_code&&r.setCountryCode(e.country_code))}});const A=async o=>{try{(o==="free"||o==="growth")&&c.dialog({title:"Confirm Change",message:`Are you sure you want to switch to the ${o} plan?`,cancel:!0,persistent:!0}).onOk(async()=>{const{error:e}=await f.from("profiles").update({plan_type:o}).eq("id",b.value.id);if(e)throw e;p.value=o,c.notify({type:"positive",message:`Switched to ${o} plan.`})})}catch{c.notify({type:"negative",message:"Failed to update plan."})}},E=()=>{v.value=!0},$=async()=>{_.value=!0;try{if(r.countryCode==="LK"||r.countryCode==="SL"){if(!x.value){c.notify({type:"warning",message:"Please upload a receipt."}),_.value=!1;return}const o=`${b.value.id}/${Date.now()}_${x.value.name}`,{data:e,error:l}=await f.storage.from("receipts").upload(o,x.value);l&&console.warn("Upload failed (mock mode?)",l);const O=e?.path||"demo_"+o,{error:F}=await f.from("payment_proofs").insert({user_id:b.value.id,amount:r.proPrice,currency:r.currency,receipt_url:O,status:"pending"});if(F)throw F;c.notify({type:"positive",message:"Receipt submitted. Plan activates upon approval."}),v.value=!1}else{await new Promise(e=>setTimeout(e,2e3));const{error:o}=await f.from("profiles").update({plan_type:"pro",subscription_status:"active"}).eq("id",b.value.id);if(o)throw o;p.value="pro",c.notify({type:"positive",message:"Payment successful! Welcome to Pro."}),v.value=!1}}catch(o){c.notify({type:"negative",message:"Error: "+o.message})}finally{_.value=!1}};return(o,e)=>(n(),m(j,{class:"q-pa-lg bg-grey-1"},{default:a(()=>[s("div",J,[e[5]||(e[5]=s("div",null,[s("h1",{class:"text-h4 text-weight-bolder text-dark q-my-none"},"Subscription Plans"),s("p",{class:"text-grey-7 q-mt-xs q-mb-none text-subtitle1"}," Choose the perfect plan for your institute. ")],-1)),s("div",Z,[e[4]||(e[4]=s("span",{class:"text-weight-bold text-primary"},"Region: ",-1)),s("span",ee,d(i(r).countryCode)+" ("+d(i(r).currency)+")",1)])]),s("div",te,[s("div",se,[t(C,{class:"full-height column no-shadow border-gray hover-lift"},{default:a(()=>[t(w,{class:"q-pa-lg"},{default:a(()=>[e[6]||(e[6]=s("div",{class:"text-overline text-grey-7 font-bold"},"STARTER",-1)),e[7]||(e[7]=s("div",{class:"text-h3 text-weight-bolder q-mt-sm"},"Free",-1)),e[8]||(e[8]=s("div",{class:"text-caption text-grey-6 q-mb-lg"},"Forever free for small classes",-1)),t(Q,{class:"q-mb-md"}),t(R,{dense:""},{default:a(()=>[(n(),h(U,null,B(N,l=>t(D,{key:l,class:"q-px-none"},{default:a(()=>[t(y,{avatar:"",style:{"min-width":"30px"}},{default:a(()=>[t(P,{name:"check",color:"green-5",size:"xs"})]),_:1}),t(y,{class:"text-grey-8"},{default:a(()=>[g(d(l),1)]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1}),t(k,{align:"center",class:"q-pa-lg mt-auto"},{default:a(()=>[p.value==="free"?(n(),m(u,{key:0,outline:"",color:"dark",label:"Current Plan",class:"full-width q-py-sm",disable:""})):(n(),m(u,{key:1,outline:"",color:"primary",label:"Select Starter",class:"full-width q-py-sm",onClick:e[0]||(e[0]=l=>A("free"))}))]),_:1})]),_:1})]),s("div",ae,[t(C,{class:"full-height column no-shadow border-gray hover-lift relative-position"},{default:a(()=>[s("div",oe,[t(L,{color:"blue-1","text-color":"blue-9",label:"POPULAR",class:"text-weight-bold"})]),t(w,{class:"q-pa-lg"},{default:a(()=>[e[10]||(e[10]=s("div",{class:"text-overline text-blue-9 font-bold"},"GROWTH",-1)),s("div",le,[g(d(i(r).countryCode==="LK"||i(r).countryCode==="SL"?"2.5%":"5%")+" ",1),e[9]||(e[9]=s("span",{class:"text-h6 text-grey-6 font-regular"},"/ txn",-1))]),e[11]||(e[11]=s("div",{class:"text-caption text-grey-6 q-mb-lg"},"Pay only when you grow",-1)),t(Q,{class:"q-mb-md"}),t(R,{dense:""},{default:a(()=>[(n(),h(U,null,B(M,l=>t(D,{key:l,class:"q-px-none"},{default:a(()=>[t(y,{avatar:"",style:{"min-width":"30px"}},{default:a(()=>[t(P,{name:"check",color:"blue-5",size:"xs"})]),_:1}),t(y,{class:"text-grey-8"},{default:a(()=>[g(d(l),1)]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1}),t(k,{align:"center",class:"q-pa-lg mt-auto"},{default:a(()=>[p.value==="growth"?(n(),m(u,{key:0,unelevated:"",color:"blue-6",label:"Current Plan",class:"full-width q-py-sm",disable:""})):(n(),m(u,{key:1,unelevated:"",color:"blue-6",label:"Upgrade to Growth",class:"full-width q-py-sm",onClick:e[1]||(e[1]=l=>A("growth"))}))]),_:1})]),_:1})]),s("div",re,[t(C,{class:"full-height column no-shadow border-emerald-glow bg-dark text-white transform-scale"},{default:a(()=>[s("div",ne,[t(L,{color:"emerald","text-color":"white",label:"RECOMMENDED",class:"text-weight-bold shadow-2"})]),t(w,{class:"q-pa-lg"},{default:a(()=>[e[13]||(e[13]=s("div",{class:"text-overline text-emerald font-bold"},"PRO",-1)),s("div",ie,[g(d(i(r).format(i(r).proPrice))+" ",1),e[12]||(e[12]=s("span",{class:"text-body2 text-grey-4 font-regular"},"/ month",-1))]),e[14]||(e[14]=s("div",{class:"text-caption text-grey-4 q-mb-lg"},"Unlimited power for large institutes",-1)),t(Q,{dark:"",class:"q-mb-md opacity-20"}),t(R,{dense:""},{default:a(()=>[(n(),h(U,null,B(V,l=>t(D,{key:l,class:"q-px-none"},{default:a(()=>[t(y,{avatar:"",style:{"min-width":"30px"}},{default:a(()=>[t(P,{name:"check",color:"emerald",size:"xs"})]),_:1}),t(y,{class:"text-grey-2"},{default:a(()=>[g(d(l),1)]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1}),t(k,{align:"center",class:"q-pa-lg mt-auto"},{default:a(()=>[p.value==="pro"?(n(),m(u,{key:0,unelevated:"",class:"full-width q-py-sm bg-emerald text-white text-weight-bold",label:"Current Plan",disable:""})):(n(),m(u,{key:1,unelevated:"",class:"full-width q-py-sm bg-emerald text-white text-weight-bold hover-bright",label:"Upgrade to Pro",onClick:E}))]),_:1})]),_:1})])]),t(K,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=l=>v.value=l),persistent:""},{default:a(()=>[t(C,{style:{"min-width":"500px"}},{default:a(()=>[t(w,null,{default:a(()=>[...e[15]||(e[15]=[s("div",{class:"text-h6"},"Upgrade to Pro",-1),s("div",{class:"text-caption text-grey-6"},"Please complete payment to activate.",-1)])]),_:1}),t(w,{class:"q-pt-none"},{default:a(()=>[S.value==="LK"?(n(),h("div",de,[s("div",ue,[e[17]||(e[17]=s("div",{class:"text-weight-bold q-mb-xs"},"Bank Transfer Details",-1)),e[18]||(e[18]=s("div",{class:"text-caption"},"Bank: Commercial Bank",-1)),e[19]||(e[19]=s("div",{class:"text-caption"},"Account No: 123456789",-1)),e[20]||(e[20]=s("div",{class:"text-caption"},"Branch: Colombo 7",-1)),e[21]||(e[21]=s("div",{class:"text-caption"},"Name: DigyNex Systems",-1)),s("div",ce,[e[16]||(e[16]=g(" Amount: ",-1)),s("span",me,d(i(r).format(i(r).proPrice)),1)])]),e[22]||(e[22]=s("div",{class:"text-weight-medium q-mb-sm"},"Upload Payment Receipt",-1)),t(W,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),outlined:"",dense:"",label:"Slip / Screenshot",accept:"image/*,.pdf",class:"q-mb-md"},{prepend:a(()=>[t(P,{name:"cloud_upload"})]),_:1},8,["modelValue"])])):(n(),h("div",pe,[s("div",fe,d(i(r).format(i(r).proPrice))+" / month ",1),e[23]||(e[23]=s("p",{class:"text-grey-6"},"Secure payment via Stripe.",-1))]))]),_:1}),t(k,{align:"right"},{default:a(()=>[z(t(u,{flat:"",label:"Cancel",color:"grey"},null,512),[[G]]),t(u,{unelevated:"",color:S.value==="LK"?"secondary":"primary",label:S.value==="LK"?"Submit Receipt":"Pay Now",loading:_.value,onClick:$},null,8,["color","label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Be=Y(ge,[["__scopeId","data-v-01e140a6"]]);export{Be as default};
