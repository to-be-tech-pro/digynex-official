import{o as E,O as f,m as _,n as V,p as s,q as d,f as t,Q as p,X as q,D as C,v as w,S as I,z as h,W as F,Y as S,P as r,a8 as O,a7 as R,r as m}from"./index-BCoBQOFT.js";import{Q as H}from"./QBadge-CD0MS9Rg.js";import{Q as W,a as k}from"./QTable-Dv_xctJK.js";import{Q as D,a as G}from"./QItem-Wb4A_Ad7.js";import{Q as z}from"./QList-TwHTGU55.js";import{Q as L}from"./QMenu-CRQWq3Fk.js";import{Q as g}from"./QSelect-DZMeRPTx.js";import{Q as X}from"./QPage-DNQfSVvF.js";import{C as Q}from"./ClosePopup-DoFqAVUY.js";import{u as Y}from"./use-quasar-DuPF83ky.js";import{u as J}from"./currency-FmnwYlLu.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QLinearProgress-DcUDM4wH.js";import"./position-engine-BGz6yeZ8.js";import"./QChip-B9sWOFsV.js";import"./QItemLabel-djxoAbwS.js";import"./format-CoaQEihs.js";import"./index-D5GkNzM3.js";const Z={class:"row items-center justify-between q-mb-lg"},ee={class:"q-gutter-x-sm"},le={class:"text-h6"},ae={class:"row q-col-gutter-sm"},te={class:"col-12"},se={class:"col-6"},oe={class:"col-6"},de={class:"col-12"},ne={class:"col-6"},ue={class:"col-6"},ie={class:"col-6"},re={class:"col-6"},me={class:"col-6"},ce={class:"col-6"},fe={__name:"ClassesPage",setup(ve){const n=Y(),y=J(),i=m(!1),l=m({}),c=m(!1),u=m(!1),v=m([]),x=m([]),U=["Grade 6","Grade 7","Grade 8","Grade 9","Grade 10","Grade 11","Grade 12","Grade 13","Other"],T=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],j=[{name:"name",required:!0,label:"Class Name",align:"left",field:"name",sortable:!0},{name:"subject",align:"left",label:"Subject",field:"subject",sortable:!0},{name:"grade",align:"left",label:"Grade",field:"grade",sortable:!0},{name:"day",align:"left",label:"Day",field:"day",sortable:!0},{name:"time",align:"left",label:"Time",field:o=>`${o.start_time||""} - ${o.end_time||""}`},{name:"hall",align:"left",label:"Hall",field:"hall"},{name:"fee",align:"right",label:"Fee ("+y.currency+")",field:"fee",sortable:!0,format:o=>y.format(o)},{name:"status",align:"left",label:"Status",field:"status",sortable:!0},{name:"actions",align:"right",label:"",field:"actions"}];E(()=>{b(),A()});const b=async()=>{u.value=!0;const{data:o,error:e}=await f.from("classes").select(`
        *,
        tutors (name)
    `).order("created_at",{ascending:!1});e?(console.error("Error fetching classes:",e),n.notify({type:"negative",message:"Failed to load classes"})):v.value=o,u.value=!1},A=async()=>{const{data:o,error:e}=await f.from("tutors").select("id, name").eq("status","Active");e||(x.value=o)},N=()=>{l.value={status:"Active"},c.value=!1,i.value=!0},M=o=>{l.value={...o},c.value=!0,i.value=!0},P=async()=>{if(u.value=!0,!l.value.name){n.notify({type:"warning",message:"Class Name is required"}),u.value=!1;return}const o={name:l.value.name,subject:l.value.subject,grade:l.value.grade,tutor_id:l.value.tutor_id,day:l.value.day,hall:l.value.hall,start_time:l.value.start_time,end_time:l.value.end_time,fee:l.value.fee,status:l.value.status};if(c.value){const{error:e}=await f.from("classes").update(o).eq("id",l.value.id);e?n.notify({type:"negative",message:e.message}):(n.notify({type:"positive",message:"Class updated successfully"}),b(),i.value=!1)}else{const{error:e}=await f.from("classes").insert([o]);e?n.notify({type:"negative",message:e.message}):(n.notify({type:"positive",message:"New class created successfully"}),b(),i.value=!1)}u.value=!1},$=o=>{n.dialog({title:"Confirm Deletion",message:"Are you sure you want to remove this class?",cancel:!0,persistent:!0,ok:{label:"Delete",color:"negative",flat:!0}}).onOk(async()=>{u.value=!0;const{error:e}=await f.from("classes").delete().eq("id",o);e?n.notify({type:"negative",message:e.message}):(v.value=v.value.filter(a=>a.id!==o),n.notify({type:"positive",message:"Class removed successfully",icon:"delete"})),u.value=!1})};return(o,e)=>(_(),V(X,{class:"q-pa-lg"},{default:s(()=>[d("div",Z,[e[11]||(e[11]=d("div",null,[d("h1",{class:"text-h5 text-weight-bold q-my-none text-dark"},"Classes & Schedule"),d("p",{class:"text-grey-6 q-mt-xs q-mb-none"},"Manage class schedules, fees, and allocations.")],-1)),d("div",ee,[t(p,{unelevated:"",icon:"add",color:"primary",label:"New Class","no-caps":"",onClick:N})])]),t(q,{class:"no-shadow border-gray"},{default:s(()=>[t(W,{rows:v.value,columns:j,"row-key":"id",flat:"",bordered:"",pagination:{rowsPerPage:10},loading:u.value},{"body-cell-status":s(a=>[t(k,{props:a},{default:s(()=>[t(H,{color:a.row.status==="Active"?"green-1":"red-1","text-color":a.row.status==="Active"?"green-8":"red-8",class:"q-px-sm q-py-xs text-weight-bold"},{default:s(()=>[w(h(a.row.status),1)]),_:2},1032,["color","text-color"])]),_:2},1032,["props"])]),"body-cell-actions":s(a=>[t(k,{props:a,"auto-width":""},{default:s(()=>[t(p,{flat:"",round:"",dense:"",icon:"more_vert",color:"grey-7"},{default:s(()=>[t(L,null,{default:s(()=>[t(z,{style:{"min-width":"100px"}},{default:s(()=>[C((_(),V(D,{clickable:"",onClick:B=>M(a.row)},{default:s(()=>[t(G,null,{default:s(()=>[...e[12]||(e[12]=[w("Edit",-1)])]),_:1})]),_:1},8,["onClick"])),[[Q]]),t(I),C((_(),V(D,{clickable:"",class:"text-red",onClick:B=>$(a.row.id)},{default:s(()=>[t(G,null,{default:s(()=>[...e[13]||(e[13]=[w("Delete",-1)])]),_:1})]),_:1},8,["onClick"])),[[Q]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}),t(F,{modelValue:i.value,"onUpdate:modelValue":e[10]||(e[10]=a=>i.value=a),persistent:""},{default:s(()=>[t(q,{style:{"min-width":"500px"}},{default:s(()=>[t(S,null,{default:s(()=>[d("div",le,h(c.value?"Edit Class Details":"Add New Class"),1)]),_:1}),t(S,{class:"q-pt-none q-gutter-y-md"},{default:s(()=>[d("div",ae,[d("div",te,[t(r,{outlined:"",modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.name=a),label:"Class Name (e.g. Grade 10 Maths Revision)",dense:""},null,8,["modelValue"])]),d("div",se,[t(g,{outlined:"",modelValue:l.value.grade,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.grade=a),options:U,label:"Grade",dense:""},null,8,["modelValue"])]),d("div",oe,[t(r,{outlined:"",modelValue:l.value.subject,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.subject=a),label:"Subject",dense:""},null,8,["modelValue"])]),d("div",de,[t(g,{outlined:"",modelValue:l.value.tutor_id,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.tutor_id=a),options:x.value,"option-value":"id","option-label":"name",label:"Tutor",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),d("div",ne,[t(g,{outlined:"",modelValue:l.value.day,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.day=a),options:T,label:"Day",dense:""},null,8,["modelValue"])]),d("div",ue,[t(r,{outlined:"",modelValue:l.value.hall,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.hall=a),label:"Hall / Room",dense:""},null,8,["modelValue"])]),d("div",ie,[t(r,{outlined:"",modelValue:l.value.start_time,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.start_time=a),label:"Start Time",type:"time",dense:""},null,8,["modelValue"])]),d("div",re,[t(r,{outlined:"",modelValue:l.value.end_time,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.end_time=a),label:"End Time",type:"time",dense:""},null,8,["modelValue"])]),d("div",me,[t(r,{outlined:"",modelValue:l.value.fee,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.fee=a),modelModifiers:{number:!0},label:`Monthly Fee (${O(y).currency})`,type:"number",dense:""},null,8,["modelValue","label"])]),d("div",ce,[t(g,{outlined:"",modelValue:l.value.status,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.status=a),options:["Active","Inactive"],label:"Status",dense:""},null,8,["modelValue"])])])]),_:1}),t(R,{align:"right",class:"text-primary q-pa-md"},{default:s(()=>[C(t(p,{flat:"",label:"Cancel",color:"grey"},null,512),[[Q]]),t(p,{unelevated:"",label:c.value?"Save Changes":"Create Class",color:"primary",onClick:P},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},je=K(fe,[["__scopeId","data-v-e364dc5d"]]);export{je as default};
