import{r as d,o as j,O as m,m as _,n as D,p as s,q as u,f as a,Q as f,X as T,Y as Q,v as i,W as N,D as I,z as x,y as U,a9 as X,F as Y,B as H,P as V,a7 as J}from"./index-BCoBQOFT.js";import{Q as K}from"./QTooltip-C3k5xbmb.js";import{Q as Z,a as ee}from"./QTable-Dv_xctJK.js";import{Q as ae}from"./QToolbarTitle-DloqS1VZ.js";import{Q as le}from"./QToolbar-D2GMqklU.js";import{Q as M,a as g}from"./QItem-Wb4A_Ad7.js";import{Q as h}from"./QItemLabel-djxoAbwS.js";import{Q as te}from"./QBadge-CD0MS9Rg.js";import{Q as se}from"./QList-TwHTGU55.js";import{Q as oe}from"./QSelect-DZMeRPTx.js";import{Q as ne}from"./QPage-DNQfSVvF.js";import{C as A}from"./ClosePopup-DoFqAVUY.js";import{u as re}from"./use-quasar-DuPF83ky.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./position-engine-BGz6yeZ8.js";import"./QLinearProgress-DcUDM4wH.js";import"./QChip-B9sWOFsV.js";import"./QMenu-CRQWq3Fk.js";import"./format-CoaQEihs.js";const ue={class:"row items-center justify-between q-mb-lg"},ie={class:"row q-gutter-xs"},me={class:"row q-col-gutter-lg justify-center"},fe={class:"col-12 col-md-8"},ce={key:0,class:"text-center q-pa-lg"},pe={__name:"ExamsPage",setup(ge){const v=re(),B=d([]),C=d([]),b=d(!1),y=d(!1),c=d(null),q=d(!1),k=d(!1),w=d(!1),E=d([]),o=d({name:"",class_id:null,date:new Date().toISOString().slice(0,10),total_marks:100}),O=[{name:"name",label:"Exam Name",field:"name",align:"left",sortable:!0},{name:"class",label:"Class",field:t=>t.classes?.name,align:"left"},{name:"date",label:"Date",field:"date",align:"left",sortable:!0},{name:"actions",label:"",field:"actions",align:"right"}];j(async()=>{S(),P()});const S=async()=>{const{data:t}=await m.from("exams").select("*, classes(name)").order("date",{ascending:!1});t&&(B.value=t)},P=async()=>{const{data:t}=await m.from("classes").select("id, name, grade").eq("status","Active");t&&(C.value=t)},R=async()=>{q.value=!0;const{error:t}=await m.from("exams").insert([o.value]);t?v.notify({type:"negative",message:t.message}):(v.notify({type:"positive",message:"Exam scheduled"}),S(),b.value=!1,o.value={name:"",class_id:null,date:new Date().toISOString().slice(0,10),total_marks:100}),q.value=!1},$=async t=>{c.value=t,y.value=!0,k.value=!0;const e=C.value.find(r=>r.id===t.class_id);if(!e){k.value=!1;return}const{data:l}=await m.from("students").select("id, name").eq("grade",e.grade).eq("status","Active"),{data:n}=await m.from("exam_results").select("*").eq("exam_id",t.id);E.value=l.map(r=>{const p=n?n.find(W=>W.student_id===r.id):null;return{student_id:r.id,student_name:r.name,marks:p?p.marks:null,grade:p?p.grade:null,result_id:p?p.id:null}}),k.value=!1},z=(t,e)=>{if(e===null||e===""){t.grade=null;return}const l=Number(e),n=c.value.total_marks||100,r=l/n*100;r>=75?t.grade="A":r>=65?t.grade="B":r>=50?t.grade="C":r>=35?t.grade="S":t.grade="W"},F=t=>{switch(t){case"A":return"green";case"B":return"blue";case"C":return"orange";case"S":return"grey-7";case"W":return"red";default:return"grey-4"}},G=async()=>{w.value=!0;const t=E.value.filter(l=>l.marks!==null&&l.marks!=="").map(l=>({exam_id:c.value.id,student_id:l.student_id,marks:l.marks,grade:l.grade}));if(t.length===0){w.value=!1;return}const{error:e}=await m.from("exam_results").upsert(t,{onConflict:"exam_id, student_id"});e?v.notify({type:"negative",message:e.message}):(v.notify({type:"positive",message:"Results saved successfully"}),y.value=!1),w.value=!1},L=t=>{confirm("Delete this exam and all its results?")&&m.from("exams").delete().eq("id",t).then(({error:e})=>{e||(S(),v.notify("Deleted"))})};return(t,e)=>(_(),D(ne,{class:"q-pa-lg"},{default:s(()=>[u("div",ue,[e[7]||(e[7]=u("div",null,[u("h1",{class:"text-h5 text-weight-bold q-my-none text-dark"},"Exam & Results"),u("p",{class:"text-grey-6 q-mt-xs q-mb-none"},"Schedule exams and enter marks.")],-1)),u("div",null,[a(f,{unelevated:"",icon:"add",color:"primary",label:"New Exam","no-caps":"",onClick:e[0]||(e[0]=l=>b.value=!0)})])]),a(T,{class:"no-shadow border-gray q-mb-lg"},{default:s(()=>[a(Q,null,{default:s(()=>[...e[8]||(e[8]=[u("div",{class:"text-subtitle1 text-weight-bold"},"Scheduled Exams",-1)])]),_:1}),a(Z,{rows:B.value,columns:O,"row-key":"id",flat:"",bordered:""},{"body-cell-actions":s(l=>[a(ee,{props:l,"auto-width":""},{default:s(()=>[u("div",ie,[a(f,{flat:"",round:"",dense:"",icon:"edit",color:"blue",onClick:n=>$(l.row)},{default:s(()=>[a(K,null,{default:s(()=>[...e[9]||(e[9]=[i("Enter Marks",-1)])]),_:1})]),_:1},8,["onClick"]),a(f,{flat:"",round:"",dense:"",icon:"delete",color:"red",onClick:n=>L(l.row.id)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1}),a(N,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=l=>y.value=l),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:s(()=>[a(T,null,{default:s(()=>[a(le,{class:"bg-primary text-white"},{default:s(()=>[I(a(f,{flat:"",round:"",dense:"",icon:"arrow_back"},null,512),[[A]]),a(ae,null,{default:s(()=>[i("Enter Marks: "+x(c.value?.name),1)]),_:1}),a(f,{flat:"",label:"Save All",onClick:G,loading:w.value},null,8,["loading"])]),_:1}),a(Q,{class:"q-pa-md"},{default:s(()=>[u("div",me,[u("div",fe,[k.value?(_(),U("div",ce,[a(X,{size:"3em",color:"primary"})])):(_(),D(se,{key:1,separator:"",bordered:"",class:"rounded-borders"},{default:s(()=>[a(M,{class:"bg-grey-2 text-weight-bold"},{default:s(()=>[a(g,null,{default:s(()=>[...e[10]||(e[10]=[i("Student Name",-1)])]),_:1}),a(g,null,{default:s(()=>[i("Marks (Out of "+x(c.value?.total_marks)+")",1)]),_:1}),a(g,null,{default:s(()=>[...e[11]||(e[11]=[i("Grade",-1)])]),_:1})]),_:1}),(_(!0),U(Y,null,H(E.value,l=>(_(),D(M,{key:l.student_id},{default:s(()=>[a(g,null,{default:s(()=>[a(h,null,{default:s(()=>[i(x(l.student_name),1)]),_:2},1024),a(h,{caption:""},{default:s(()=>[i(x(l.student_id),1)]),_:2},1024)]),_:2},1024),a(g,null,{default:s(()=>[a(V,{dense:"",outlined:"",modelValue:l.marks,"onUpdate:modelValue":[n=>l.marks=n,n=>z(l,n)],modelModifiers:{number:!0},type:"number",max:c.value?.total_marks},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024),a(g,null,{default:s(()=>[a(te,{color:F(l.grade),class:"text-subtitle2 q-pa-xs"},{default:s(()=>[i(x(l.grade||"-"),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=l=>b.value=l)},{default:s(()=>[a(T,{style:{"min-width":"400px"}},{default:s(()=>[a(Q,null,{default:s(()=>[...e[12]||(e[12]=[u("div",{class:"text-h6"},"Schedule New Exam",-1)])]),_:1}),a(Q,{class:"q-pt-none q-gutter-y-md"},{default:s(()=>[a(V,{outlined:"",modelValue:o.value.name,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.name=l),label:"Exam Name (e.g. Term Test 1)",dense:""},null,8,["modelValue"]),a(oe,{outlined:"",modelValue:o.value.class_id,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.class_id=l),options:C.value,"option-label":"name","option-value":"id",label:"Class",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),a(V,{outlined:"",modelValue:o.value.date,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.date=l),type:"date",label:"Date",dense:""},null,8,["modelValue"]),a(V,{outlined:"",modelValue:o.value.total_marks,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.total_marks=l),type:"number",label:"Total Marks",dense:""},null,8,["modelValue"])]),_:1}),a(J,{align:"right"},{default:s(()=>[I(a(f,{flat:"",label:"Cancel"},null,512),[[A]]),a(f,{unelevated:"",label:"Create",color:"primary",onClick:R,loading:q.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Me=de(pe,[["__scopeId","data-v-01067470"]]);export{Me as default};
